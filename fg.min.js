let isRecording=!1,chunks=[],micdata=[],thisblob,recorder,mediaRecorder,termsCheckbox,thisFormFillerGPTform,theseFormFillerGPTforms=[],theseFormFillerGPTMics=[],lastResponse,countdownTimer,countdownInterval,thisPopupContainer;function handleMicClick(e){dbg(["thisformsent",thisFormFillerGPTform=e.target.form,e,e.target,e.target.form]),isRecording?(stopRecording(),e.target.classList.remove("recording")):launchPopup(e)}function stopRecording(){let e=!1;clearInterval(countdownInterval),recorder&&"inactive"!==recorder.state&&(e=!0,recorder.stop(),isRecording=!1),dbg(["didStop",e])}function startCountdown(){countdownTimer=60,countdownInterval=setInterval(()=>{countdownTimer--,document.querySelector(".formgpt-form-genie-timer").textContent=`Recording will stop in ${countdownTimer} seconds`,0===countdownTimer&&stopRecording()},1e3)}function dbg(e){console.log(e)}function appendStyles(){let e=`
            .formgpt-form-genie-popup-container {
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                justify-content: center;
                align-items: center;
            }
            .formgpt-form-genie-popup-content {
                width: 80%;
                max-width: 500px;
                background: #fff;
                padding: 20px;
                border-radius: 5px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            }
            @keyframes NOPEformgpt-form-genie-wiggle {
                0% { transform: rotate(0deg); }
                15% { transform: rotate(-7deg); }
                30% { transform: rotate(7deg); }
                45% { transform: rotate(-7deg); }
                60% { transform: rotate(7deg); }
                75% { transform: rotate(-7deg); }
                90% { transform: rotate(7deg); }
                100% { transform: rotate(0deg); }
            }
            .formgpt-form-genie {
                position: absolute;
                animation: formgpt-form-genie-wiggle 0.2s ease-in-out infinite;
                animation-delay: 3s; 
                transition: all 3.2s ease;
            }
            .formgpt-form-genie.recording {
                animation: none;
            }
            .formgpt-form-genie.complete {
                transform: scale(1.2);
            }
        `,t=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e)),t.appendChild(o)}function grabFormData(e){let t=new FormData(e);return[...t.entries()]}function sendAudio(e,t,o){stopRecording(),dbg(["sendingAudio",e,t,thisblob,micdata]);let r=new Blob(micdata,{type:"audio/webm"}),n=grabFormData(e),i=new FormData;i.append("audio",r),i.append("formdata",n),i.append("formHTML",thisFormFillerGPTform.innerHTML),i.append("loc",window.location.href),i.append("path",window.location.pathname),i.append("host",window.location.hostname),i.append("hash",window.location.hash),fetch("https://formfillergpt.com",{method:"POST",body:i}).then(e=>e.json()).then(e=>{e.forEach(e=>{console.log(e);let t=thisFormFillerGPTform.querySelector(`[name="${e.fieldName}"]`);if(t)switch(e.fieldType){case"text":case"textarea":case"password":case"email":case"tel":t.value=e.fieldValue;break;case"select-one":for(let o=0;o<t.options.length;o++)if(t.options[o].value==e.fieldValue){t.selectedIndex=o;break}break;case"radio":case"checkbox":Array.isArray(e.fieldValue)?e.fieldValue.forEach(e=>{t.value==e&&(t.checked=!0)}):t.value==e.fieldValue&&(t.checked=!0)}}),o.target.classList.remove("recording"),o.target.classList.add("complete"),document.body.removeChild(thisPopupContainer),setTimeout(()=>{o.target.classList.remove("complete")},3e3)}).catch(e=>{console.error("An error occurred",e),o.target.classList.remove("recording")})}function isValidForm(e){let t=e.querySelectorAll('input:not([type="hidden"]), select, textarea, button'),o=e.querySelectorAll('input[type="password"]'),r=e.querySelectorAll('input[type="email"]'),n=Array.from(e.querySelectorAll("input")).filter(e=>["search","query","q"].includes(e.name.toLowerCase()));return t.length<=2?(dbg("2orless"),!1):1===o.length&&t.length<=3?(dbg("loginform"),!1):1===r.length&&t.length<=2?(dbg("emailonlyform"),!1):1===n.length&&t.length<=2?(dbg("searchform"),!1):(dbg("goodformfound"),!0)}function launchPopup(e){dbg("launchPopup"),e.preventDefault(),createPopup(),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{console.log("startedRecording"),(recorder=new MediaRecorder(e)).addEventListener("start",e=>{console.log("starting..."),micdata.length=0,startCountdown()}),recorder.addEventListener("dataavailable",e=>{console.log("adding..."),micdata.push(e.data)}),recorder.addEventListener("stop",()=>{console.log("stopping..."),thisblob=new Blob(micdata,{type:"audio/webm"})}),recorder.start()}).catch(e=>{console.log(["ERRORMIC",e]),console.error("Could not get user media",e)})}function createPopup(){if(document.querySelector(".formgpt-form-genie-popup-container")||document.querySelector(".formgpt-form-genie-popup-container"))return;let e=document.createElement("div");e.classList.add("formgpt-form-genie-popup-container");let t=document.createElement("div");t.classList.add("formgpt-form-genie-popup-content");let o=document.createElement("h3");o.textContent="Speak out the form";let r=document.createElement("div");r.classList.add("formgpt-form-genie-waveform");let n=document.createElement("p");n.classList.add("formgpt-form-genie-timer"),thisPopupContainer=e;let i=document.createElement("button");i.classList.add("formgpt-form-genie-cancel"),i.innerHTML="✗",i.addEventListener("click",()=>{stopRecording(),document.body.removeChild(thisPopupContainer)});let a=document.createElement("button");a.classList.add("formgpt-form-genie-submit"),a.innerHTML="✔";let l=document.createElement("div");l.classList.add("formgpt-form-genie-buttons"),l.appendChild(i),l.appendChild(a),a.addEventListener("click",e=>{termsCheckbox.checked?sendAudio(thisFormFillerGPTform,chunks,e):alert("Please accept the terms and conditions to proceed")}),(termsCheckbox=document.createElement("input")).type="checkbox",termsCheckbox.classList.add("formgpt-form-genie-terms-checkbox");let d=document.createElement("label");d.classList.add("formgpt-form-genie-terms-label"),d.innerHTML='You agree to let me use your voice to fill out the form out which requires sharing with third parties. The complete agreement can be found <a href="https://example.com/terms-of-service" target="_blank">here</a>.',d.insertBefore(termsCheckbox,d.firstChild),t.appendChild(o),t.appendChild(r),t.appendChild(n),t.appendChild(l),t.appendChild(d),e.appendChild(t),document.body.appendChild(e)}function getFormControls(e){return e.querySelectorAll("input, select, textarea, button")}function appendMicrophoneToForm(){document.querySelectorAll("form").forEach(e=>{if("true"===e.getAttribute("data-processed")){dbg("wasprocessed");return}if(e.setAttribute("data-processed","true"),theseFormFillerGPTforms.push(e),!isValidForm(e)){dbg("noforms");return}let t=document.createElement("div");t.classList.add("formgpt-form-genie");let o=document.createElement("button");o.classList.add("formgpt-form-genie-mic"),o.innerHTML="\uD83C\uDFA4",o.addEventListener("click",handleMicClick),t.appendChild(o);let r=e.querySelector('input:not([type="hidden"]), select, textarea'),n=r.parentElement;t.style.position="absolute";let i=r.getBoundingClientRect(),a=n.getBoundingClientRect();t.style.left=`${i.left-a.left}px`,t.style.top=`${i.top-a.top}px`,t.style.opacity="0.5",t.style.zIndex="999",n.appendChild(t);let l=getComputedStyle(n).position;["static","initial","inherit"].includes(l)&&(n.style.position="relative"),console.log(e,t)})}appendStyles(),appendMicrophoneToForm();